<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sport Streaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="madan ram">
  {% load staticfiles %}
	<!--link rel="stylesheet/less" href="less/bootstrap.less" type="text/css" /-->
	<!--link rel="stylesheet/less" href="less/responsive.less" type="text/css" /-->
	<!--script src="js/less-1.3.3.min.js"></script-->
	<!--append ‘#!watch’ to the browser URL, then refresh the page. -->
	
	<link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet">
	<link href="{% static "css/style.css" %}" rel="stylesheet"> 

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
  <![endif]-->

<!--   <link rel="shortcut icon" href="img/favicon.png"> -->
	<script type="text/javascript" src="{% static "js/jquery.min.js" %}"></script>
	<script type="text/javascript" src="{% static "js/bootstrap.min.js" %}"></script>
	<link rel="stylesheet" href="{% static "lib/codemirror.css" %}">
    <script src="{% static "lib/codemirror.js" %}"></script>
    <script src="{% static "mode/pig/pig.js" %}"></script>
    <script src="{% static "lib/util/simple-hint.js" %}"></script>
    <script src="{% static "lib/util/pig-hint.js" %}"></script>
    <link rel="stylesheet" href="{% static "lib/util/simple-hint.css" %}">
    <!-- <link rel="stylesheet" href="{% static "doc/docs.css" %}"> -->
    
</head>

<body>
		<textarea id="code" name="code" ></textarea>
		<br>
		<button class="btn btn-default" onclick="runIt()" >run script</button>
		<button class="btn btn-default" onclick="stopIt()" >Stop All</button>
		<script>
			count = 0;
			var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
				lineNumbers: true,
				matchBrackets: true,
				indentUnit: 4,
				mode: "text/x-pig",
				onKeyEvent: function(cm, ke) {
					if(ke.type == "keyup" && ke.keyCode != 8 /* backspace */) {
					setTimeout(function(){CodeMirror.simpleHint(cm, CodeMirror.pigHint);},50);    
					}
				}
			});

			function runIt() {
				$.ajax({
				    type: 'POST', // it's easier to read GET request parameters
				    url: 'request_server',
				    dataType: 'JSON',
				    data: {
				      'type':'start',
				      'job_id': count+1,
				      'code': editor.getValue() // look here!
				    },
				    success: function(data) {
				    	alert(data);
				    	count = count+1;
				    },
				    error: function(xhr,err) {
				        alert(err);
				    }
				});
			}

			function stopIt() {
			    var xmlhttp;
			    if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
			        xmlhttp = new XMLHttpRequest();
			    } else { // code for IE6, IE5
			        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			    }
			    xmlhttp.onreadystatechange = function() {
			        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			            alert('sucessfuly stoped');
			        }
			    }
			    xmlhttp.open("GET", "grunt-stop", true);
			    xmlhttp.send();
			}
	    </script>
</body>
</html>

<pre>
	A = LOAD '/twitter_out' USING PigStorage();
	DUMP A ;
</pre>
